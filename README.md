# Helper 
     一个使用Python编写，基于OpenCV的画面内容识别算法项目
     该项目还处于初级开发阶段，任何功能函数方法都具有不确定的变更，但会尽可能的不变更函数调用方式
     目前仅支持MEMU，理论上支持其他模拟器、安卓实体机，但要修改部分脚本
     (测试通过于 MEMU安卓分辨率1920x1080 系统分辨率3840x2160 系统缩放200%)
     
### 警告 该项目几乎违反所有网络游戏或网络软件的用户协议!
     仅允许个人以学习为目的使用 禁止用于任何商用盈利违法等用途
     因使用本项目 产生的一切问题后果由使用者自行承担 产生的任何法律后果由使用者自行承担
     
     后果包括但不限于：游戏封禁或回档、账户拉黑或锁定、违法相关法律法规被起诉
 
### 用户自定义脚本

     自行编写的建议结构
          import ...
          
          函数1 : ...
          ...
          函数N : ...
          
          主循环 : ...
          
          定义安卓模拟器
          ...
          
          初始化循环选择器
          ...
          
          循环入口 : ...
     
#### 1.制作图像匹配资源
     1.0 关于分辨率的问题
          (!)本项目CV处理的图像分辨率和安卓实际分辨率不一样，默认是1280x720，可在*Env.py里修改
          (!)安卓模拟器的分辨率是1920x1080，但模拟器窗口显示虚拟机画面的分辨率，在获取画面时会被设置为1280x720
             也就是制作匹配资源的全程都以分辨率1280x720为准，算法会解决映射到模拟器1920x1080的问题
          (!)在*Env.py里有一个cv缩放倍率cvScale，模板匹配成功后会缩放到模拟器1920x1080的触摸坐标

     1.1 修改*Win32.py脚本 
          (1)if __name__ == '__main__' : 内的 VM = GetVMScreen(title='VM')
             把 title='VM' 的 VM 改为目标模拟器的窗口标题，可在任务管理器里看到这个标题
          (2)save = 'debug\\' + time.strftime('%Y%m%d.%H%M%S', time.localtime(time.time()))[2 :] + '.tif'
             'debug\\' 的 debug 为保存截图的文件夹，可以修改，若不存在需要自行建立
          (3)执行*Win32.py脚本后，若修改正确会在保存文件就里看到一个以时间为文件名的tif图像文件

     1.2 裁剪被识别图像模板
          (0)本教程以Photoshop为主，且不会过多强调在PS里如何操作
             也可以使用其他支持 选区 图层 辅助线 快速导出图层 的二维图像编辑工具
          (1)使用选区尽可能大的选定 被识别图像区域，切记不要包含其他无关内容，除非没办法了或使用透明图像匹配
             若必须使用透明图像匹配的模板，给模板的图层加蒙版，然后使用铅笔黑色画掉希望透明的区域
             例如要选找 [圆角的确定按钮]，就矩形选择 [圆角的确定按钮] 但不包含左右两边的圆角部分
          (2)然后Ctrl+J拷贝图层，会得到一个新图层，双击它的文字重命名为方便后期寻找的名字，
             例如 01某界面01某按钮，可以让资源管理器按照前面的数字顺序排列显示文件，方便寻找图像
          (3)然后选定背景图层，重复Ctrl+J拷贝图层得到所有需要的图像模板，不选背景图层就Ctrl+J空气了
          (4)最后按住Ctrl选择所有模板图层，右键快速导出为PNG，在保存的文件夹可以看到导出的图像
          
#### 用于学习该项目的功能模板
          基于 MEMU 测试开发的 [公主连结Re:Dive简体服] 小号每日内容自动辅助脚本 
          目前仅稍稍完善了 地下城AutoDungeon(MEMU) 下一关AutoNextLevel(MEMU)，需要自行编辑脚本切换
          警告 该自定义脚本违反 上海宽娱数码科技有限公司运营的游戏(公主连结Re:Dive)内发布的游戏公平运营声明 如下链接
          ![image](https://user-images.githubusercontent.com/15169084/165489327-bdeff184-9d93-433a-a63f-47055934f484.png)
          使用者自行承担一切后果。本项目若收到该游戏运营方删除该自定义脚本的要求，会移除该自定义脚本及图像资源。
     
### 依赖&调用 (当前仅支持Windows环境)
     平台接口：pywin32 win32gui
     图像处理：opencv-python Pillow numpy
     日志输出：colorama colorlog
     可能移除：keyboard
     Pip自动安装 pip install -r requirements
     
### 功能&实现

#### 　 定义安卓设备类
     用于定义模拟安卓设备的类 
     *Event.py 内提供了如下类与方法
     　  定义安卓模拟器 mudevice(addr=Adb控制IP地址端口, title=模拟器窗口标题, inputdev=触摸事件输入地址)
     　  连接设备 mudevice.connect()
         发送指令 mudevice.command(单行shell指令)
         发送事件 mudevice.sendevent(事件列表)
         调试触摸 mudevice.inputTouch(数组(x,y), 结束延迟)
         事件触摸 mudevice.eventTouch(数组(x,y), 按压时间, 重复次数, 每次结束延迟)
           ↑ 实验性，存在adb反应慢，某些应用内无法完成单击的问题
         获取屏幕 mudevice.GetScreen()
         
#### 　 获取Windows窗口画面
     窗口必须前台 (可以被遮挡 可以在其他桌面 不能最小化)
     *Win32.py 内提供了如下函数
     　  获取系统内所有窗口   GetWinHandler()
     　  获取安卓模拟器句柄   GetMuHandler()
     　  获取安卓模拟器画面   GetVMScreen(title=句柄标题,Mu='MEMU')
     在自定义用户python脚本内的使用方式为 定义安卓设备前
     　  ... 预运行部分 ...
     　  GetMuHandler() # 获取可选的模拟器实例列表 (正在完善，可以匹配到黑名单外的所有QT外壳窗口，但不影响后期使用)
     　  ... 安卓设备定义 ...
        
#### 　 自定义脚本资源定义
     用于定义被查找图像的类
     *Env.py 内提供了如下类与方法
     　  定义资源 definetl(图像文件集根目录, 图像文件路径, 文本注释, 感兴趣区域, 反馈触摸区域, [读取模式])
                 例如 自定义脚本的资源存放于 AAAA文件夹下：definetl('.\\AAAA\\', 'Image.png', 'xxxxx', ....)
                 感兴趣区域与反馈触摸区域 元组(X1,Y1,X2,Y2) 是基于CV算法分辨率的像素区域
                 例如1280x720的算法分辨率，只对左上角100,100到200,200区域进行图像匹配：(100,100,200,200)
                 只对150,150到250,250区域内进行安卓模拟点击 (150,150,250,250)，实际使用需要缩放回模拟器的实际坐标
